<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Dream Interpretation Viewer</title>
        <link
            href="https://fonts.googleapis.com/css2?family=Spectral:wght@400;600&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="src/style.css" />
        <style>
            h1 {
                font-size: 2rem;
                margin-bottom: 1rem;
                color: #2c2c2c;
            }

            .section {
                background: #fffdf9;
                border-radius: 10px;
                box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);
                padding: 1.5rem;
                margin-bottom: 2rem;
            }

            .section h2 {
                font-size: 1.4rem;
                margin-bottom: 0.5rem;
                color: #4a3b3b;
            }

            .section p,
            .section li {
                line-height: 1.6;
            }

            ul {
                padding-left: 1.25rem;
                margin-top: 0.5rem;
            }

            .persona-block {
                margin-bottom: 1.5rem;
            }
            .persona-block h3 {
                font-weight: bold;
                font-size: 1.1rem;
                color: #555;
                margin-bottom: 0.3rem;
            }
            .persona-image {
                width: 10%;
                border-radius: 50%;
                float: right;
            }
            blockquote {
                margin: 0.5rem 0;
                padding-left: 1rem;
                border-left: 3px solid #ddd;
                color: #555;
                font-style: italic;
            }

            textarea {
                width: calc(100% - 1.5rem);
                height: 150px;
                border: 1px solid #ccc;
                border-radius: 6px;
                padding: 0.75rem;
                font-family: Georgia, serif;
                font-size: 1rem;
                resize: vertical;
                box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
                background: #fffdfb;
            }

            #app {
                padding: 30px;
                display: flex;
                align-items: flex-start;
                max-width: 1000px;
                margin: auto;
            }

            #sidebar {
                width: 250px;
                padding-right: 1rem;
                flex-shrink: 0;
            }

            #sidebar button {
                display: block;
                width: 100%;

                background: var(--bg-section-medium);

                border: none;
                padding: 0.5rem;
                margin-bottom: 0.5rem;
                text-align: left;

                font-family: var(--font-primary);
                font-size: 0.95rem;
                border-radius: 6px;
                cursor: pointer;
                transition: background 0.2s;
            }

            #sidebar button:hover {
                background: var(--bg-section-light);
                font-weight: 900;
                filter: brightness(0.9);
            }
            #sidebar button#create-new-dream-btn {
                background: var(--bg-button-accent);
                margin-bottom: 2em;
                color: white;
            }
            #sidebar button#create-new-dream-btn:hover {
            }
            #sidebar a {
                text-decoration: none;
            }
            #output {
                flex: 1;
            }
            /* Hide mobile dropdown by default */
            #mobileSelectorWrapper {
                display: none;
            }

            #dreamSelector {
                width: 100%;
                padding: 0.75rem;
                font-size: 1rem;
                font-family: Georgia, serif;
                border-radius: 6px;
                border: 1px solid #ccc;
                background: #fff;
            }

            /* Mobile layout */
            @media (max-width: 768px) {
                #app {
                    flex-direction: column;
                }

                #sidebar {
                    display: none;
                }

                #mobileSelectorWrapper {
                    display: block;
                    margin-bottom: 1rem;
                }

                #output {
                    width: 100%;
                }

                textarea {
                    height: 120px;
                }
            }
        </style>
    </head>
    <body>
        <header class="navbar">
            <a href="/index.html"
                ><div class="logo">
                    <!-- Make sure favi.png is accessible at this path -->
                    <img
                        class="ball"
                        src="images/favi.png"
                        alt="Dream Logo Icon"
                    />
                    What did I dream?
                </div></a
            >
        </header>

        <div id="app">
            <div id="mobileSelectorWrapper">
                <a href="/index.html#dream-input">
                    <button
                        id="create-new-dream-btn"
                        class="sidebar-button create-button"
                        onclick="createNewDreamEntry()"
                    >
                        + Create New Entry
                    </button></a
                >
                <select id="dreamSelector"></select>
            </div>
            <div id="sidebar"></div>
            <div id="output"></div>
        </div>

        <script>
            const personaImageMap = {
                "Dr. Helga Stein": "images/circles/helga.jpg",
                "White Otter": "images/circles/otter.jpg",
                "Mrs. Clara Whitmore": "images/circles/whitmore.jpg",
                "Shaykh Zafir": "images/circles/zafir.jpg",
                Azure: "images/circles/azure.jpg",
                "Dr. Margaret Lang": "images/circles/lang.jpg",
                "Isidoro Marquez": "images/circles/marquez.jpg",
                "Brother Severinus": "images/circles/severinus.jpg",
                "Imam Yusuf ibn Kareem": "images/circles/yusuf.jpg",
                "Master Lin": "images/circles/lin.jpg",
                "Swami Pranava": "images/circles/pranava.jpg",
                "Roxy Mirage": "images/circles/roxy.jpg",
                "Dr. Lina Axon": "images/circles/axon.jpg",
                "Mother Rowan": "images/circles/rowan.jpg",
                Patchwork: "images/circles/patchwork.jpg",
            };

            let dreams = [];
            let currentDreamIndex = 0;

            function renderSidebar(dreams) {
                const sidebar = document.getElementById("sidebar");

                const newEntryButtonHTML = `
                  <a href="/index.html#dream-input">
                                <button id="create-new-dream-btn" class="sidebar-button create-button" onclick="createNewDreamEntry()">
                                    + Create New Entry
                                </button></a>
                            `;

                const dreamButtonsHTML = dreams
                    .map(
                        (d, i) =>
                            `<button onclick="renderDream(${i})">${d.dream_title}</button>`,
                    )
                    .join("");

                sidebar.innerHTML = newEntryButtonHTML + dreamButtonsHTML;
                // Also update the mobile dropdown
                const select = document.getElementById("dreamSelector");
                select.innerHTML = dreams
                    .map(
                        (d, i) =>
                            `<option value="${i}">${d.dream_title}</option>`,
                    )
                    .join("");
                select.value = currentDreamIndex;
            }

            function renderDream(index) {
                currentDreamIndex = index;
                const data = dreams[index];
                const container = document.getElementById("output");

                container.innerHTML = `
        <div class="section">
          <h1>${data.dream_title}</h1>
        </div>

        <div class="section">
          <h2>Dream Echo</h2>
          <blockquote>${data.dream_echo}</blockquote>
        </div>

        <div class="section">
          <h2>Symbols</h2>
          <ul>${data.symbols.map((s) => `<li>${s}</li>`).join("")}</ul>
        </div>

        <div class="section">
          <h2>Interpretations</h2>
          ${data.persona_interpretations
              .map(
                  (p) => `
            <div class="persona-block">
            <img class="persona-image"src="${personaImageMap[p.persona]}" />
              <h3>${p.persona}</h3>


              <p>${p.interpretation}</p>
            </div>

          `,
              )
              .join("")}
        </div>

        <div class="section">
          <h2>Reflection Questions</h2>
          <ul>${data.reflection.map((r) => `<li>${r}</li>`).join("")}</ul>
        </div>

        <div class="section">
          <h2>Analysis</h2>
          ${data.analysis.map((p) => `<p>${p}</p>`).join("")}
        </div>

        <div class="section">
          <h2>Your Notes</h2>
          <textarea id="notes" placeholder="Write your thoughts, questions, or insights here..."></textarea>
        </div>
      `;

                // Restore notes from localStorage
                const notesField = document.getElementById("notes");
                const storageKey = `dream-notes-${data.dream_title}`;
                notesField.value = localStorage.getItem(storageKey) || "";
                notesField.addEventListener("input", () => {
                    localStorage.setItem(storageKey, notesField.value);
                });

                // Sync mobile selector
                const select = document.getElementById("dreamSelector");
                select.value = index;
            }

            document
                .getElementById("dreamSelector")
                .addEventListener("change", (e) => {
                    const index = parseInt(e.target.value, 10);
                    renderDream(index);
                });

            fetch("./data.json")
                .then((response) => response.json())
                .then((data) => {
                    dreams = data;
                    renderSidebar(dreams);
                    renderDream(0); // Load first dream by default
                })
                .catch((error) => console.error("Error loading JSON:", error));
        </script>
    </body>
</html>
